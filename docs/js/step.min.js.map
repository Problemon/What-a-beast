{"version":3,"sources":["step.js"],"names":["DATA","showEndGame","backToElections","addClassHidden","removeClassHidden","buttonNext","document","querySelector","buttonBack","steps","givenNodeAnswer","currentStep","stepList","currentLevel","currentRightAnswers","givenRightAnswers","indexStep","Number","localStorage","getItem","renderStepAnswer","image","indexImage","numbers","isRounded","renderStepAnswers","dataStep","images","map","join","renderStep","title","renderStepsOfLevel","level","levelIndex","nodeSteps","LEVELS","number","insertAdjacentHTML","renderSteps","levels","forEach","onStepListChange","classList","remove","showCurrentStep","addEventListener","getCheckedAnswer","getDataOfAnswer","element","closest","src","clearStepListChange","removeEventListener","hideCurrentStep","checkedAnswer","checked","add","checkAnswer","value","dataOfAnswer","push","setItem","JSON","stringify","onButtonNextClick","length","removeItem","onButtonBackClick","checkStorageRignAnswers","inStorage","parse","setLogicOfSteps","rightAnswers","querySelectorAll"],"mappings":"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","file":"step.min.js","sourcesContent":["import { DATA } from './data.min.js';\nimport { showEndGame } from './end.min.js';\nimport { backToElections } from './elections.min.js';\nimport { addClassHidden, removeClassHidden } from './util.min.js';\n\nconst buttonNext = document.querySelector('.options__button--next');\nconst buttonBack = document.querySelector('.options__button--back');\n\nlet steps;\nlet givenNodeAnswer;\nlet currentStep;\nlet stepList;\nlet currentLevel;\nlet currentRightAnswers;\n\nlet givenRightAnswers = [];\nlet indexStep = Number(localStorage.getItem('indexStep'));\n\nif (!indexStep) {\n  indexStep = 0;\n}\n\nconst renderStepAnswer = (image, indexImage, numbers, isRounded) => (`\n  <label class=\"step__item\">\n    <input class=\"step__radio visually-hidden\" type=\"radio\" value=\"${indexImage + 1}\" name=\"${numbers[0]}-${numbers[1]}\">\n    <picture>\n      <source srcset=\"img/items/${image}.webp 1x, img/items/${image}@2x.webp 2x\">\n      <img class=\"step__image ${isRounded ? 'step__image--rounded' : ''}\" src=\"img/items/${image}.png\" srcset=\"img/items/${image}@2x.png 2x\" width=\"300\" height=\"300\" alt=\"\" draggable=\"false\">\n    </picture>\n    <div class=\"step__check-mark\"></div>\n  </label>\n`);\n\nconst renderStepAnswers = (dataStep, numbers) => {\n  const {images, isRounded} = dataStep;\n  const answersMarkup = images.map((image, indexImage) => renderStepAnswer(image, indexImage, numbers, isRounded));\n\n  return (`\n    <fieldset class=\"step__list\">\n      ${answersMarkup.join('\\n')}\n    </fieldset>\n  `);\n};\n\nconst renderStep = (dataStep, numbers) => {\n  const {title} = dataStep;\n\n  return (`\n    <li class=\"level__step step step--hidden container\" data-class=\"step\">\n      <header class=\"step__header\">\n        <h2 class=\"step__title title title--step\">${title}</h2>\n      </header>\n        ${renderStepAnswers(dataStep, numbers)}\n    </li>\n  `);\n};\n\nconst renderStepsOfLevel = (level, levelIndex) => {\n  const dataStepsOfLevel = DATA.LEVELS[levelIndex];\n  const nodeSteps = dataStepsOfLevel.map((dataStep, number) => renderStep(dataStep, [levelIndex, number]));\n\n  level.insertAdjacentHTML('beforeend', nodeSteps.join('\\n'));\n};\n\nconst renderSteps = (levels) => {\n  levels.forEach((level, levelIndex) => renderStepsOfLevel(level, levelIndex));\n};\n\nconst onStepListChange = () => {\n  buttonNext.classList.remove('button--hidden');\n};\n\nconst showCurrentStep = () => {\n  currentStep = steps[indexStep];\n  stepList = currentStep.querySelector('.step__list');\n\n  removeClassHidden(currentStep);\n  stepList.addEventListener('change', onStepListChange);\n};\n\nconst getCheckedAnswer = () => stepList.querySelector('input:checked');\n\nconst getDataOfAnswer = (element) => {\n  const stepItem = element.closest('.step__item');\n  const stepItemImageSrc = stepItem.querySelector('.step__image').src;\n  const answerData = {\n    image: stepItemImageSrc,\n  };\n\n  return answerData;\n};\n\nconst clearStepListChange = () => {\n  stepList.removeEventListener('change', onStepListChange);\n};\n\nconst hideCurrentStep = () => {\n  const checkedAnswer = getCheckedAnswer();\n\n  if(checkedAnswer) {\n    checkedAnswer.checked = false;\n  }\n\n  buttonNext.classList.add('button--hidden');\n\n  clearStepListChange();\n  addClassHidden(currentStep);\n};\n\nconst checkAnswer = () => {\n  givenNodeAnswer = getCheckedAnswer();\n  const rightAnswerOfStep = currentRightAnswers[indexStep];\n  const givenAnswerOfStepValue = Number(givenNodeAnswer.value);\n\n  if (rightAnswerOfStep === givenAnswerOfStepValue) {\n    const dataOfAnswer = getDataOfAnswer(givenNodeAnswer);\n    givenRightAnswers.push(dataOfAnswer);\n\n    localStorage.setItem('givenRightAnswers', JSON.stringify(givenRightAnswers));\n  }\n};\n\nconst onButtonNextClick = () => {\n  checkAnswer();\n\n  if (indexStep === steps.length - 1) {\n    hideCurrentStep();\n    showEndGame(currentLevel, givenRightAnswers, currentRightAnswers);\n\n    givenRightAnswers = [];\n    indexStep = 0;\n    localStorage.removeItem('indexStep');\n  } else {\n    hideCurrentStep();\n\n    indexStep += 1;\n    localStorage.setItem('indexStep', indexStep);\n\n    showCurrentStep();\n  }\n};\n\nconst onButtonBackClick = () => {\n  if (indexStep === 0) {\n    backToElections(currentLevel);\n\n    givenRightAnswers = [];\n\n    localStorage.removeItem('givenRightAnswers');\n    localStorage.removeItem('indexStep');\n    localStorage.removeItem('indexLevel');\n  } else {\n    hideCurrentStep();\n\n    indexStep -= 1;\n    localStorage.setItem('indexStep', indexStep);\n\n    showCurrentStep();\n  }\n};\n\nconst checkStorageRignAnswers = () => {\n  const inStorage = JSON.parse(localStorage.getItem('givenRightAnswers'));\n  if (inStorage) {\n    givenRightAnswers = inStorage;\n  }\n};\n\nconst setLogicOfSteps = (level, rightAnswers) => {\n  localStorage.setItem('rightAnswers', JSON.stringify(rightAnswers));\n\n  currentLevel = level;\n  currentRightAnswers = rightAnswers;\n  checkStorageRignAnswers();\n\n  steps = level.querySelectorAll('.step');\n\n  showCurrentStep();\n};\n\nbuttonBack.addEventListener('click', () => onButtonBackClick());\nbuttonNext.addEventListener('click', () => onButtonNextClick());\n\nexport {setLogicOfSteps, renderSteps};\n"]}